# scope:fleet
wtmnb_safe_destroy_fleet = {
	save_event_target_as = wtmnb_booming_fleet
	every_owned_ship = {
		limit = {
			NOT = {
				is_ship_size = wtmnb_boomer
			}
		}
		save_event_target_as = wtmnb_booming_ship
		owner = {
			# 摧毁舰船事件1
			fire_on_action = {
				on_action = on_ship_destroyed_victim
				scopes = {
					from = event_target:wtmnb_owner
					fromfrom = event_target:wtmnb_booming_ship
					fromfromfrom = event_target:wtmnb_boomed_boomer
				}
			}
		}
		event_target:wtmnb_owner = {
			# 摧毁舰船事件2
			fire_on_action = {
				on_action = on_ship_destroyed_perp
				scopes = {
					from = event_target:wtmnb_booming_fleet.owner
					fromfrom = event_target:wtmnb_boomed_boomer
					fromfromfrom = event_target:wtmnb_booming_ship
				}
			}
		}
	}
	owner = {
		# 摧毁舰队事件1
		fire_on_action = {
			on_action = on_fleet_destroyed_victim
			scopes = {
				from = event_target:wtmnb_owner
				fromfrom = event_target:wtmnb_booming_fleet
				fromfromfrom = event_target:wtmnb_boomed_boomer.fleet
			}
		}
	}
	event_target:wtmnb_owner = {
		# 摧毁舰队事件2
		fire_on_action = {
			on_action = on_fleet_destroyed_perp
			scopes = {
				from = event_target:wtmnb_booming_fleet.owner
				fromfrom = event_target:wtmnb_boomed_boomer.fleet
				fromfromfrom = event_target:wtmnb_booming_fleet
			}
		}
	}
	destroy_and_spawn_debris_for = root
}

# 添加本mod领袖特质
add_leader_trait_wtmnb_stigmata = {
	if = {
		limit = {
			exists = owner
			owner = {
				is_gestalt = yes
			}
		}
		add_trait_no_notify = leader_trait_wtmnb_stigmata_ruler
	}
	else = {
		switch = {
			trigger = leader_class
			scientist = {
				add_trait_no_notify = leader_trait_wtmnb_stigmata_scientist_councilor
			}
			admiral = {
				add_trait_no_notify = leader_trait_wtmnb_stigmata_admiral_councilor
			}
			general = {
				add_trait_no_notify = leader_trait_wtmnb_stigmata_general_councilor
			}
			governor = {
				add_trait_no_notify = leader_trait_wtmnb_stigmata_governor_councilor
			}
		}
	}
	switch = {
		trigger = leader_class
		scientist = {
			add_trait_no_notify = leader_trait_wtmnb_stigmata_scientist
		}
		admiral = {
			add_trait_no_notify = leader_trait_wtmnb_stigmata_admiral
		}
		general = {
			add_trait_no_notify = leader_trait_wtmnb_stigmata_general
		}
		governor = {
			add_trait_no_notify = leader_trait_wtmnb_stigmata_governor
		}
		# envoy = {
		# 	add_trait = leader_trait_wtmnb_stigmata_envoy
		# }
	}
}
